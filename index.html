<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Flying Aces</title>

  <link rel="icon" type="image/png" href="https://lufberydiscgolf.wordpress.com/wp-content/uploads/2025/05/cropped-lufberyflyingace_logo_500x500-1.png?v=2">
  <link rel="apple-touch-icon" href="https://lufberydiscgolf.wordpress.com/wp-content/uploads/2025/05/cropped-lufberyflyingace_logo_500x500-1.png?v=2">

  <style>
    :root { --s: 1; }
    html, body { margin:0; padding:0; width:100%; height:100%; overflow:hidden; background:#fff; }

    /* The page itself does NOT scroll; the iframe does (native, smooth, accurate). */
    #viewport{
      position:fixed;
      inset:0;
      overflow:hidden;
      background:#fff;
      touch-action: pan-y;
    }

    #app{
      position:absolute;
      top:0; left:0;
      border:0;
      display:block;
      background:#fff;

      /* Scale the iframe visually, but expand its layout box so it still fills the screen */
      width: calc(100vw / var(--s));
      height: calc(100dvh / var(--s));
      height: calc(100vh / var(--s)); /* fallback */
      transform-origin: 0 0;
      transform: scale(var(--s));
    }
  </style>
</head>

<body>
  <div id="viewport">
    <iframe id="app" title="Flying Aces"></iframe>
  </div>

<script>
(() => {
  const EXEC = "https://script.google.com/macros/s/AKfycbyD8Of8Rq69CMvLVSeTRmCtcj8WGwC-HsdIsYSEZ0b4ylA8TvihUztv9H2wGh4vDSpDaw/exec";
  const DEFAULT_PAGE = "matchups";
  const allowed = new Set(["matchups","rankings","rosters","scoring","doubles"]);

  const iframe = document.getElementById("app");

  function normalizePage(p){
    p = String(p || "").toLowerCase().replace(/^#/, "").trim();
    if (!allowed.has(p)) p = DEFAULT_PAGE;
    if (p === "doubles") p = "rosters";
    return p;
  }

  function pickScale(){
    // Optional manual override: ?sf=0.66
    const qs = new URLSearchParams(location.search || "");
    const manual = parseFloat(qs.get("sf"));
    if (isFinite(manual) && manual >= 0.45 && manual <= 1.0) return manual;

    const w = Math.min(window.innerWidth || 400, (window.screen && window.screen.width) || 400);
    if (w <= 430) return 0.66;   // phone
    if (w <= 520) return 0.66;   // large phone / small tablet
    return 1.00;                 // desktop
  }

  function applyScale(){
    const s = pickScale();
    document.documentElement.style.setProperty("--s", String(s));
  }

  function buildSrc(page){
    const p = normalizePage(page);
    const u = new URL(EXEC);
    u.searchParams.set("p", p);
    u.searchParams.set("embed", "1");

    // IMPORTANT: let the wrapper do scaling; keep GAS at scale=1 to avoid double-scaling.
    u.searchParams.set("scale", "1");

    // cache-bust
    u.searchParams.set("v", Date.now().toString(36));
    return u.toString();
  }

  function loadFromHash(){
    const raw = location.hash.slice(1);
    const page = normalizePage(raw.split("?")[0]);
    applyScale();
    iframe.src = buildSrc(page);
  }

  function okOrigin(origin){
    return /^https:\/\/script\.google\.com$/.test(origin) ||
           /^https:\/\/script\.googleusercontent\.com$/.test(origin) ||
           /^https:\/\/[a-z0-9-]+\.googleusercontent\.com$/.test(origin);
  }

  window.addEventListener("message", (ev) => {
    const d = ev && ev.data;
    if (!d || typeof d !== "object") return;
    if (!okOrigin(ev.origin)) return;

    if (d.type === "FA_NAV") {
      const page = normalizePage(d.page);
      const cur = normalizePage(location.hash.slice(1).split("?")[0]);

      if (page !== cur) location.hash = "#" + page;
      else iframe.src = buildSrc(page);
      return;
    }
  });

  window.addEventListener("hashchange", loadFromHash);
  window.addEventListener("resize", () => {
    // Re-apply scale without reloading the page
    applyScale();
  });

  if (!location.hash) location.hash = "#" + DEFAULT_PAGE;
  loadFromHash();
})();
</script>
</body>
</html>
